<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:linear-gradient(135deg,#020617,#0f172a);color:#e5e7eb}

/* ================= NOTIF ================= */
#notifBox{
  position:fixed;top:20px;left:50%;
  transform:translateX(-50%);z-index:999
}
.notif{
  padding:14px 22px;
  border-radius:16px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  font-weight:500;
  margin-bottom:10px;
  box-shadow:0 15px 35px rgba(0,0,0,.4)
}

/* ================= HEADER ================= */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 28px;
  background:rgba(255,255,255,.05)
}
.header h1{font-size:18px;font-weight:600}
.header button{
  background:linear-gradient(135deg,#ef4444,#dc2626);
  border:none;
  padding:10px 20px;
  color:white;
  border-radius:14px;
  font-weight:500;
  cursor:pointer
}

/* ================= LAYOUT ================= */
.container{
  max-width:1200px;
  margin:auto;
  padding:24px;
  display:grid;
  grid-template-columns:1fr 420px;
  gap:24px;
}

/* ================= CARD ================= */
.card{
  background:rgba(255,255,255,.08);
  padding:22px;
  border-radius:22px;
}
.card>b{font-size:18px}

/* ================= SUMMARY ================= */
.summary{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
  margin-bottom:20px
}
.summary div{
  background:rgba(255,255,255,.1);
  padding:18px;
  border-radius:18px
}
.summary b{
  font-size:24px;
  margin-top:6px;
  display:block
}
.summary div{
  background:rgba(255,255,255,.1);
  padding:18px;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  min-width:0; /* WAJIB */
}

.summary b{
font-size:22px;
margin-top:6px;
display:block;
  white-space:nowrap;        /* ❗ TIDAK TURUN BARIS */
  overflow:hidden;           /* ❗ POTONG JIKA PANJANG */
  text-overflow:ellipsis;    /* ❗ TITIK-TITIK */
}
.summary b{
  font-size:clamp(18px, 2vw, 24px);
}



/* ================= FORM ================= */
.form{
  display:flex;
  flex-direction:column;
  gap:16px;
  margin-top:16px
}
.form input,.form select{
  padding:16px;
  border:none;
  border-radius:16px;
  font-size:15px
}
.form button{
  padding:16px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#22d3ee,#6366f1);
  color:white;
  font-size:16px;
  font-weight:600;
  cursor:pointer
}

/* ================= RIWAYAT ================= */
#riwayat{margin-top:16px}
#riwayat li{
  list-style:none;
  background:rgba(255,255,255,.1);
  padding:18px 20px;
  border-radius:20px;
  margin-bottom:14px;
  transition:.25s
}
#riwayat li:hover{
  background:rgba(255,255,255,.14)
}

.tx-top{
  display:flex;
  justify-content:space-between;
  align-items:center
}
.tx-amount{
  font-size:22px;
  font-weight:600
}

.badge{
  padding:6px 14px;
  border-radius:14px;
  font-size:14px;
  font-weight:500
}
.in{background:#22c55e}
.out{background:#ef4444}

/* ===== BARIS BAWAH RAPi ===== */
.tx-bottom{
  display:grid;
  grid-template-columns:140px 1fr auto;
  gap:14px;
  align-items:center;
  margin-top:12px
}
.tx-date{
  font-size:14px;
  opacity:.85
}
.tx-desc{
  font-size:15px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis
}
.actions{
  display:flex;
  gap:8px
}
.actions button{
  border:none;
  padding:8px 14px;
  border-radius:12px;
  font-size:13px;
  font-weight:500;
  color:white;
  cursor:pointer
}
.edit{background:#22c55e}
.delete{background:#ef4444}

/* ================= LOGOUT MODAL ================= */
#logoutModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000
}
.modal{
  background:#020617;
  padding:28px;
  border-radius:24px;
  width:320px;
  text-align:center;
  box-shadow:0 20px 50px rgba(0,0,0,.6)
}
.modal h2{
  font-size:20px;
  margin-bottom:10px
}
.modal p{
  font-size:14px;
  opacity:.85;
  margin-bottom:22px
}
.modal-actions{
  display:flex;
  gap:12px
}
.modal-actions button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:14px;
  font-weight:600;
  cursor:pointer
}
.cancel{background:#334155;color:white}
.confirm{background:linear-gradient(135deg,#ef4444,#dc2626);color:white}

/* ================= RESPONSIVE ================= */
@media(max-width:900px){
  .container{grid-template-columns:1fr}
  .tx-bottom{grid-template-columns:1fr}
}
.fade-up{
  opacity:0;
  transform:translateY(30px);
  animation:fadeUp .8s ease forwards;
}

@keyframes fadeUp{
  to{
    opacity:1;
    transform:translateY(0);
  }
}
.card{
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(16px);
  border-radius:18px;
  padding:20px;
  border:1px solid rgba(255,255,255,.2);
  box-shadow:0 20px 40px rgba(0,0,0,.25);
  transition:.4s ease;
}

.card:hover{
  transform:translateY(-8px) scale(1.02);
  box-shadow:0 30px 60px rgba(56,189,248,.45);
}
.transaksi{
  opacity:0;
  transform:translateX(-20px);
  animation:slideIn .5s ease forwards;
}

.transaksi:nth-child(1){animation-delay:.1s}
.transaksi:nth-child(2){animation-delay:.2s}
.transaksi:nth-child(3){animation-delay:.3s}

@keyframes slideIn{
  to{
    opacity:1;
    transform:translateX(0);
  }
}
button{
  transition:.3s;
}

button:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 25px rgba(56,189,248,.5);
}

button:active{
  transform:scale(.95);
}

</style>
</head>

<body>

  <div id="notifBox"></div>

<!-- LOGOUT MODAL -->
<div id="logoutModal">
  <div class="modal">
    <h2>Logout</h2>
    <p>Apakah kamu yakin ingin keluar?</p>
    <div class="modal-actions">
      <button class="cancel" onclick="closeLogout()">Batal</button>
      <button class="confirm" onclick="doLogout()">Logout</button>
    </div>
  </div>
</div>

<div class="header">
  <h3>DuitKu</h3>
  <button onclick="openLogout()">Logout</button>
</div>

<div class="container">

  <div>
    <div class="summary">
      <div>Pemasukan<b id="income">Rp 0</b></div>
      <div>Pengeluaran<b id="outcome">Rp 0</b></div>
      <div>Saldo<b id="balance">Rp 0</b></div>
    </div>

    <div class="card">
      <b>Riwayat Transaksi</b>
      <ul id="riwayat"></ul>
    </div>
  </div>

  <div class="card">
<b id="formTitle">Tambah Transaksi</b>
    <div class="form">
      <input id="amount" type="number" placeholder="Nominal">
      <input id="date" type="date">
      <select id="status">
        <option value="INCOME">Pemasukan</option>
        <option value="OUTCOME">Pengeluaran</option>
      </select>
      <input id="description" placeholder="Keterangan">
      <button onclick="saveTx()">Simpan</button>
    </div>
  </div>

</div>

<script>
const username = localStorage.getItem("username");
const txKey = "transactions_" + username;

let transactions = JSON.parse(localStorage.getItem(txKey)) || [];
let editIndex = null;

function saveStorage(){
  localStorage.setItem(txKey, JSON.stringify(transactions));
}


function showNotif(msg){
  const d=document.createElement("div");
  d.className="notif";
  d.innerText=msg;
  notifBox.appendChild(d);
  setTimeout(()=>d.remove(),2500);
}

/* ===== LOGOUT ===== */
function openLogout(){ logoutModal.style.display="flex" }
function closeLogout(){ logoutModal.style.display="none" }
function doLogout(){
  showNotif("Logout berhasil");
  setTimeout(()=>location.href="/login",1200);
}

/* ===== RENDER ===== */
function render(){
  let inc=0,out=0;
  riwayat.innerHTML="";

  transactions.forEach((t,i)=>{
    t.status==="INCOME" ? inc+=t.nominal : out+=t.nominal;

    riwayat.innerHTML+=`
      <li>
        <div class="tx-top">
          <span class="badge ${t.status==="INCOME"?"in":"out"}">
            ${t.status==="INCOME"?"Pemasukan":"Pengeluaran"}
          </span>
          <span class="tx-amount">Rp ${t.nominal.toLocaleString("id-ID")}</span>
        </div>

        <div class="tx-bottom">
          <span class="tx-date">${new Date(t.transactionDate).toLocaleDateString("id-ID")}</span>
          <span class="tx-desc">${t.description||"-"}</span>
          <div class="actions">
            <button class="edit" onclick="editTx(${i})">Edit</button>
            <button class="delete" onclick="deleteTx(${i})">Hapus</button>
          </div>
        </div>
      </li>`;
  });

  income.innerText="Rp "+inc.toLocaleString("id-ID");
  outcome.innerText="Rp "+out.toLocaleString("id-ID");
  balance.innerText="Rp "+(inc-out).toLocaleString("id-ID");
}

function saveTx(){
  if(!amount.value||!date.value) return showNotif("Nominal & tanggal wajib diisi");

  const tx={
    nominal:+amount.value,
    transactionDate:date.value,
    status:document.getElementById("status").value,
    description:description.value.trim()
  };

  editIndex!==null ? transactions[editIndex]=tx : transactions.unshift(tx);
  editIndex=null;
  saveStorage();
  amount.value=date.value=description.value="";
  render();
  showNotif("Transaksi disimpan"),
  document.getElementById("formTitle").innerText = "Tambah Transaksi";

}


function editTx(i){
  const t=transactions[i];
  amount.value=t.nominal;
  date.value=t.transactionDate;
  status.value=t.status;
  description.value=t.description||"";
  editIndex=i,
  document.getElementById("formTitle").innerText = "Edit Transaksi";


}


function deleteTx(i){
  transactions.splice(i,1);
  saveStorage();
  render();
  showNotif("Transaksi dihapus");
}

render();
</script>


</body>
</html>
